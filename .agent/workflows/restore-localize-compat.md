---
description: 逐份修复 Markdown 文档漂移：先还原上游原文，再做语义汉化，最后做 Antigravity/Codex 兼容微调。
---

# /restore-localize-compat - 文档机制对齐流程

$ARGUMENTS

---

## 目标

用于处理“本地文档与上游文档差异过大，已破坏原有机制”的场景。

核心目标：

1. **先还原机制**：以 `reference/antigravity-kit` 为唯一机制基线。
2. **再汉化语义**：仅翻译自然语言，不改处理逻辑。
3. **后做兼容微调**：仅在必要时补充 Antigravity 与 Codex 的兼容说明。

---

## 背景与问题来源

本仓库是基于上游 Antigravity 项目进行汉化与扩展的分支，并新增了 Codex 适配能力。

在历史迭代中，部分 Markdown 文档出现了以下问题：

1. 与上游文档结构和机制发生较大偏离（章节顺序、执行步骤、约束描述被改写）。
2. 混入了非功能性说明，导致功能文档可执行性下降。
3. 个别文档只做了“文本改写”，但未保持与上游脚本和流程的对应关系。

这会带来两个直接风险：

1. Antigravity 主机制被误导，行为与上游预期不一致。
2. Codex 兼容适配建立在漂移文档之上，后续维护成本和回归风险显著上升。

因此本流程采用固定顺序：

1. 先恢复上游机制基线。
2. 再进行语义汉化。
3. 最后仅做必要的兼容微调。

---

## 适用范围

- `.agent/**/*.md`
- `docs/**/*.md`
- 根目录功能文档（如 `README.md`、`AGENT_FLOW.md`、`CHANGELOG.md` 等）

优先级建议：

1. `.agent/skills/**/SKILL.md`
2. `.agent/agents/*.md`
3. `.agent/workflows/*.md`
4. 其他功能与运维文档

---

## 硬性约束（必须遵守）

1. **禁止脚本批量改写文档内容**（可使用检索命令定位，但修改必须逐份人工完成）。
2. **每次只处理 1 份文档**，完成后立即提交并推送。
3. **不得改机制**：不得删除/新增上游机制步骤、命令、参数语义、脚本调用关系。
4. **非功能性说明不得进入功能文档**（如宣传语、个人化样例、无关解释）。
5. **保留通用英文专有名词**（见下方术语表）。

---

## 术语保留规则（不要翻译）

默认保留英文写法：

- Antigravity
- Codex
- Skill / Skills
- Agent / Agents
- Workflow / Workflows
- Rule / Rules
- MCP
- CLI
- Frontmatter
- Schema
- API / SDK
- URL
- path

---

## 三阶段执行流程（逐文件）

### Phase 1：还原上游原文（先还原）

对当前处理文件 `<file>`：

1. 找到上游对照文件：`reference/antigravity-kit/<file>`。
2. 先把本地内容恢复为上游结构与机制（章节、顺序、命令、参数、脚本路径保持一致）。
3. 确认未引入“上游补充说明”“reference 对齐提示”等后加段落。

仅用于核对的命令示例（可用）：

```bash
diff -u reference/antigravity-kit/<file> <file>
```

### Phase 2：语义汉化（不改机制）

在 Phase 1 基础上做语义翻译，规则如下：

1. 只翻译自然语言说明。
2. 保持以下内容原样：
   - 代码块内容
   - 命令与参数（如 `--target`、`--fix`）
   - 文件名与路径（如 `.agent/`、`SKILL.md`）
   - 占位符（如 `$ARGUMENTS`）
   - Frontmatter key（如 `description`）
3. 标题层级、段落顺序、列表结构不变。

### Phase 3：兼容微调（必要才做）

仅在出现真实冲突时微调：

1. **Antigravity 基线**：保留其官方机制与触发方式，不改默认工作流语义。
2. **Codex 兼容**：仅补充与本仓库适配层直接相关的信息（如 `.agents`、映射与托管规则）。
3. 微调应为最小改动，且不能反向破坏上游机制。

---

## 验收清单（每份文档都要过）

1. 与上游对比后，机制性元素一致（章节流程、命令、参数、脚本引用不漂移）。
2. 仅语言层发生变化，不出现逻辑重写。
3. 无非功能性说明残留。
4. 术语保留符合规则。
5. 文档中的路径、命令、文件引用可执行或可解析。

---

## 提交流程（强制）

每处理完 1 份文档，立刻执行：

```bash
git add <file>
git commit -m "docs: 对齐上游机制并语义汉化 <file>"
git push
```

然后再处理下一份文档。

---

## 建议报告模板（给编排者）

```markdown
## 文档处理报告

- 文件：`<file>`
- 结果：完成 / 阻塞
- 上游对照：`reference/antigravity-kit/<file>`
- 机制修复点：
  1. ...
  2. ...
- 汉化说明：
  1. ...
  2. ...
- 兼容微调：
  1. ...
- 提交记录：`<commit-sha>`
```
