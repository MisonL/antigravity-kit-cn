---
name: vulnerability-scanner
description: 漏洞分析原则、OWASP Top 10 与供应链安全。涵盖 2025 威胁图谱、风险优先级排序及自动化扫描方法论。
allowed-tools: Read, Glob, Grep, Bash
---

# 漏洞分析专家 (Vulnerability Scanner)

> 像攻击者一样思考，像专家一样防守。洞察 2025 年最新的安全威胁。

---

## 🔧 运行时脚本

**执行以下脚本进行自动化验证：**

| 脚本                       | 用途                         | 执行命令                                     |
| -------------------------- | ---------------------------- | -------------------------------------------- |
| `scripts/security_scan.py` | 验证当前项目是否符合安全准则 | `python scripts/security_scan.py <项目路径>` |

---

## 📋 参考清单

| 引用文件                       | 用途                                                      |
| ------------------------------ | --------------------------------------------------------- |
| [checklists.md](checklists.md) | 涵盖 OWASP Top 10、身份认证、API 安全及数据保护的详细清单 |

---

## 1. 安全专家思维 (Expert Mindset)

### 核心原则

| 原则                            | 应用方法                             |
| ------------------------------- | ------------------------------------ |
| **假定失陷 (Assume Breach)**    | 假设攻击者已经入侵内网，据此设计防御 |
| **零信任 (Zero Trust)**         | 永不信任，始终验证每一处请求         |
| **纵深防御 (Defense in Depth)** | 设置多层防护，消除单点故障风险       |
| **最小特权 (Least Privilege)**  | 仅授予执行任务所需的最低限度权限     |
| **失败安全 (Fail Secure)**      | 当发生异常或错误时，默认拒绝访问     |

---

## 2. OWASP Top 10:2025 (最新版)

### 风险类别

| 排名    | 类别                                 | 核心关注点                                         |
| ------- | ------------------------------------ | -------------------------------------------------- |
| **A01** | 访问控制失效 (Broken Access Control) | 谁能访问什么？重点：IDOR, SSRF                     |
| **A02** | 安全配置错误                         | 默认配置、HTTP 标头、云环境配置                    |
| **A03** | 软件供应链安全 🆕                    | 依赖包、CI/CD 管道、构建一致性                     |
| **A04** | 加密失败                             | 弱加密算法、密钥泄露                               |
| **A05** | 注入攻击 (Injection)                 | 用户输入直接转化为系统命令                         |
| **A06** | 不安全的设计                         | 架构层面的缺陷而非单纯的代码实现                   |
| **A07** | 身份认证失败                         | 会话管理、暴力破解防护                             |
| **A08** | 完整性失效                           | 未签名的更新、数据被篡改                           |
| **A09** | 安全日志与告警                       | 监控盲点、缺乏实时响应能力                         |
| **A10** | 异常条件处理 🆕                      | 错误处理不当导致的权限泄露或“失败打开 (Fail-open)” |

---

## 3. 供应链安全 (A03)

### 攻击面分析

| 向量          | 风险项                        | 关键追问                     |
| ------------- | ----------------------------- | ---------------------------- |
| **依赖项**    | 含有后门的恶意包              | 我们是否审计过新引入的依赖？ |
| **Lock 文件** | 依赖混淆/篡改攻击             | `lock` 文件是否已妥善提交？  |
| **构建管道**  | CI/CD 环境被劫持              | 谁有权修改构建脚本？         |
| **注册表**    | 拼写纠缠/劫持 (Typosquatting) | 是否使用了受信任的镜像源？   |

---

## 4. 攻击面映射 (Attack Surface Mapping)

- **入口点**：API 接口、表单、文件上传入口。
- **数据流向**：输入 → 处理逻辑 → 输出全路径追踪。
- **信任边界**：明确身份验证与授权校验发生的节点。

---

## 5. 风险优先级排序 (Risk Prioritization)

### CVSS + 业务上下文

```
风险 = 可能性 (Likelihood) × 影响 (Impact)
```

- **关键 (CRITICAL)**：正在被利用 (EPSS > 0.5) 且 CVSS ≥ 9.0。
- **高 (HIGH)**：导致敏感数据泄露或权限提升。

---

## 6. 异常条件处理 (A10 - 新增)

### “失败打开 (Fail-Open)” vs “失败关闭 (Fail-Closed)”

- **场景：身份验证逻辑出错**。
- ❌ **Fail-Open**：默认允许访问（极度危险）。
- ✅ **Fail-Closed**：默认拒绝所有权限。

---

## 7. 扫描方法论 (Scanning Methodology)

1. **侦察 (Reconnaissance)**：映射技术栈、入口点与数据流。
2. **发现 (Discovery)**：通过配置审计、依赖分析与代码模式搜索识别潜在问题。
3. **分析 (Analysis)**：剔除误报，锁定攻击链。
4. **报告 (Reporting)**：提供清晰的复现步骤与修复建议。

---

## 8. 高风险代码模式

- **SQL/命令注入**：字符串拼接构建查询语句。
- **动态代码执行**：使用 `eval()`, `exec()`, `Function()`。
- **不安全的反序列化**：使用 `pickle.loads()`, `unserialize()`。
- **路径遍历**：将用户输入直接用于文件系统路径。

---

## 9. 应避免的反模式 (Anti-Patterns)

| ❌ 禁止 (Don't)          | ✅ 推荐 (Do)                   |
| ------------------------ | ------------------------------ |
| 盲目扫描而不理解业务流程 | 先映射攻击面再着手扫描         |
| 仅修复症状而忽略根因     | 针对架构层面的缺陷进行根治     |
| 盲目信任第三方依赖       | 校验包完整性并执行代码审计     |
| 发布前才进行单次扫描     | 建立持续集成中的自动化安全扫描 |

---

## 10. 报告准则

每个漏洞项必须清晰回答：

1. **是什么？** —— 漏洞类型描述。
2. **在哪里？** —— 确切的文件、行号或 API 端点。
3. **危害？** —— 对业务的具体影响。
4. **如何修复？** —— 给出行之有效的修复方案。

---

> **谨记：** 漏洞扫描只是发现问题，专家的思维在于识别真正致命的威胁。始终思考：“如果我是攻击者，我会如何利用这一点？”

---

## Skills 兼容说明 (最小补充)

- **机制基线**：沿用上游 `.agent/skills/vulnerability-scanner/SKILL.md`。
- **Codex 适配**：由适配层映射到 `.agents/skills/vulnerability-scanner/SKILL.md`。
- **注意**：文档层不应替代安全加固方案；仅在此定义漏洞分析准则。
