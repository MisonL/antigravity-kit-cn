---
name: systematic-debugging
description: 4 阶段系统化调试方法论，包括根因分析和基于证据的验证。用于调试复杂问题。
allowed-tools: Read, Glob, Grep
---

# 系统化调试 (Systematic Debugging)

> 来源：obra/superpowers

---

## 概述

此技能 (Skill) 提供了一种结构化的调试方法，旨在防止盲目猜测，并确保在解决问题之前已经对其进行了透彻的理解。

---

## 4 阶段调试流程

### 阶段 1：复现 (Reproduce)

在修复之前，必须能够稳定地复现该问题。

```markdown
## 复现步骤

1. [复现的具体步骤]
2. [下一步]
3. [预期结果 vs 实际结果]

## 复现率

- [ ] 总是 (100%)
- [ ] 经常 (50-90%)
- [ ] 有时 (10-50%)
- [ ] 罕见 (<10%)
```

### 阶段 2：隔离 (Isolate)

缩小问题的范围。

```markdown
## 隔离问题

- 这个问题是什么时候开始出现的？
- 最近发生了哪些变更？
- 是否在所有环境中都会出现？
- 能否用最精简的代码复现？
- 触发该问题的最小变更是什么？
```

### 阶段 3：理解 (Understand)

寻找根本原因 (Root cause)，而不仅仅是表面症状。

```markdown
## 根因分析

### 5 Whys (追问 5 个为什么)

1. 为什么：[第一个观察到的现象]
2. 为什么：[更深层的原因]
3. 为什么：[进一步的原因]
4. 为什么：[接近真相的原因]
5. 为什么：[根本原因]
```

### 阶段 4：修复与验证 (Fix & Verify)

修复问题并验证其已真正解决。

```markdown
## 修复验证

- [ ] 错误不再复现
- [ ] 相关功能依然正常
- [ ] 未引入新的问题
- [ ] 已添加测试以防止回归
```

---

## 调试检查清单

```markdown
## 开始之前

- [ ] 可以持续复现
- [ ] 拥有最小复现案例 (Minimal reproduction case)
- [ ] 理解预期行为

## 调查期间

- [ ] 检查最近的变更 (`git log`)
- [ ] 检查日志中的错误
- [ ] 根据需要添加日志
- [ ] 使用调试器/断点

## 修复之后

- [ ] 记录根本原因
- [ ] 验证修复效果
- [ ] 添加回归测试
- [ ] 检查类似的代码段
```

---

## 常用调试命令

```bash
# 最近的变更
git log --oneline -20
git diff HEAD~5

# 搜索特定模式
grep -r "错误模式 (errorPattern)" --include="*.ts"

# 检查日志
pm2 logs "应用名称 (app-name)" --err --lines 100
```

---

## 反模式 (Anti-Patterns)

❌ **随意变更** —— “也许我改了这里就好了……”
❌ **忽视证据** —— “那不可能是原因。”
❌ **主观臆断** —— 在没有证据的情况下断定“肯定是因为 X”。
❌ **未先复现** —— 盲目修复。
❌ **止于表面** —— 未能找到根本原因。
