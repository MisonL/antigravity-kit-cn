# Agent 协同

> App Builder 如何编排各领域专家 Agent。

## Agent 流水线

```
┌─────────────────────────────────────────────────────────────┐
│                   APP BUILDER (编排器)                       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     PROJECT PLANNER                          │
│  • 任务拆解                                                  │
│  • 依赖图                                                    │
│  • 文件结构规划                                              │
│  • 在项目根目录创建 {task-slug}.md (强制性)                   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                 检查点：计划验证（Plan Verification）         │
│  🔴 验证：项目根目录是否存在 {task-slug}.md？                   │
│  🔴 如果 否 → 停止 → 先创建计划文件                            │
│  🔴 如果 是 → 继续执行专家 Agent                               │
└─────────────────────────────────────────────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│ DATABASE        │ │ BACKEND         │ │ FRONTEND        │
│ ARCHITECT       │ │ SPECIALIST      │ │ SPECIALIST      │
│                 │ │                 │ │                 │
│ • Schema 设计   │ │ • API 路由      │ │ • 组件          │
│ • 数据库迁移    │ │ • 控制器        │ │ • 页面          │
│ • 种子数据      │ │ • 中间件        │ │ • 样式          │
└─────────────────┘ └─────────────────┘ └─────────────────┘
          │                   │                   │
          └───────────────────┼───────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                 并行阶段（可选）                             │
│  • Security Auditor（安全审计） → 漏洞检查                   │
│  • Test Engineer（测试工程） → 单元测试                      │
│  • Performance Optimizer（性能优化） → 包体积分析            │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     DEVOPS ENGINEER                          │
│  • 环境设置                                                  │
│  • 预览部署                                                  │
│  • 健康检查                                                  │
└─────────────────────────────────────────────────────────────┘
```

## 执行顺序

| 阶段 | Agent（智能体）                             | 是否并行？ | 前置条件           | 检查点                    |
| ---- | ------------------------------------------ | ---------- | ------------------ | ------------------------- |
| 0    | 苏格拉底之门（Socratic Gate）               | ❌         | -                  | ✅ 提出 3 个问题          |
| 1    | Project Planner（项目规划）                 | ❌         | 问题已回答         | ✅ **PLAN.md 已创建**     |
| 1.5  | **计划验证（Plan Verification）**           | ❌         | PLAN.md 存在       | ✅ **根目录存在计划文件** |
| 2    | Database Architect（数据库架构）            | ❌         | 计划就绪           | Schema 已定义             |
| 3    | Backend Specialist（后端专家）              | ❌         | Schema 就绪        | API 路由已创建            |
| 4    | Frontend Specialist（前端专家）             | ✅         | API 就绪（部分）   | UI 组件就绪               |
| 5    | Security Auditor（安全审计）、Test Engineer（测试工程） | ✅ | 代码就绪 | 测试与审计通过 |
| 6    | DevOps Engineer（运维工程）                 | ❌         | 所有代码就绪       | 部署就绪                  |

> 🔴 **关键：** 阶段 1.5 是强制性的。没有 PLAN.md 验证，任何专家 Agent 不得进行后续操作。
