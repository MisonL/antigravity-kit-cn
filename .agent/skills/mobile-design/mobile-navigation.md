---
description: 导航模式、深度链接、返回处理与 Tab/Stack/Drawer 决策
---

# 移动端导航参考 (Mobile Navigation Reference)

> 导航模式、深度链接、返回处理与 Tab/Stack/Drawer 决策。
> **导航是 App 的骨架——弄错了它，整个 App 就会感觉不对劲。**

---

## 1. 导航选择决策树

```
什么类型的 APP？
        │
        ├── 3-5 个顶级板块 (同等重要)
        │   └── ✅ 标签栏 (Tab Bar / Bottom Navigation)
        │       示例: 社交, 电商, 工具
        │
        ├── 深度层级内容 (逐层深入)
        │   └── ✅ 栈导航 (Stack Navigation)
        │       示例: 设置, 邮件文件夹
        │
        ├── 很多目的地 (>5 个顶级)
        │   └── ✅ 抽屉导航 (Drawer Navigation)
        │       示例: Gmail, 复杂企业应用
        │
        ├── 单一线性流程
        │   └── ✅ 仅栈导航 (Stack only)
        │       示例: 结账, 安装向导
        │
        └── 平板/折叠屏
            └── ✅ 侧边导航栏 (Navigation Rail) + 列表详情
                示例: iPad 上的邮件, 笔记
```

---

## 2. 标签栏导航 (Tab Bar)

### 何时使用

- ✅ **使用** 当：3-5 个顶级目的地，同等重要，需频繁切换，每个标签有独立栈。
- ❌ **避免** 当：>5 个目的地，有清晰层级，使用频率极不均衡，顺序流程。

### 标签栏最佳实践

**iOS Tab Bar:**

- 高度: 49pt (带 Home indicator 为 83pt)
- 最大项数: 5
- 标签: 始终显示 (为了可访问性)

**Android Bottom Navigation:**

- 高度: 80dp
- 最大项数: 5 (3-5 理想)
- 标签: 始终显示

### 标签状态持久化 (Tab State Preservation)

**规则:** 每个标签必须维护自己的导航栈。

**用户旅程:**

1.  首页 Tab → 点进商品 → 加入购物车
2.  切换到 个人 Tab
3.  切回 首页 Tab
4.  → **必须** 回到 "加入购物车" 屏幕，**而不是** 首页根目录。

**实现:**

- React Navigation: 每个 Tab 有自己的 Navigator。
- Flutter: 使用 `IndexedStack`。

---

## 3. 栈导航 (Stack Navigation)

### 核心概念

- **Push**: 压入新屏幕 (前进)
- **Pop**: 移除顶层屏幕 (返回)
- **Replace**: 替换当前屏幕
- **Reset**: 清空栈，设置新根

### 返回按钮处理

**跨平台规则:**

- Back **始终** 向上回溯栈 (Pop)。
- **永远不要** 劫持返回按钮用于其他目的 (除非是关闭模态)。
- 丢弃未保存数据前要**确认**。
- 深度链接进入时，应构造完整的返回栈。

---

## 4. 抽屉导航 (Drawer Navigation)

### 何时使用

- ✅ **使用** 当：>5 个顶级目的地，低频访问，复杂功能，需要展示用户信息/品牌。
- ❌ **避免** 当：≤5 个目的地，移动优先的简单应用，可发现性至关重要 (抽屉是隐藏的)。

### 抽屉模式

- **模态抽屉 (Modal)**: 覆盖在内容之上，汉堡菜单触发。 (手机常用)
- **永久抽屉 (Permanent)**: 始终可见。 (平板/桌面)
- **侧边栏 (Rail)**: Android 平板常用，窄条图标。

---

## 5. 模态导航 (Modal Navigation)

### Modal vs Push

| PUSH (Stack)          | MODAL                     |
| :-------------------- | :------------------------ |
| 水平滑入 (Horizontal) | 垂直滑起 (Vertical Sheet) |
| 层级的一部分          | 独立的任务                |
| 返回 (Back) 退出      | 关闭 (Dismiss/X) 退出     |
| 同一导航上下文        | 自己的导航上下文          |
| "钻取信息 (Drill in)" | "聚焦任务 (Focus task)"   |

**使用 MODAL 用于:**

- 创建新内容
- 设置/偏好
- 完成交易
- 独立的工作流
- 快速操作

### 模态关闭

用户期望通过以下方式关闭：

- 点击 X / 关闭按钮
- 向下滑动 (Sheet)
- 点击背景遮罩 (非关键)
- 系统返回键 (Android)

**规则:** 仅在有未保存数据时阻止关闭 (并提示)。

---

## 6. 深度链接 (Deep Linking)

### 为什么一开始就要做

- 推送通知导航
- 分享内容
- 营销活动
- Widget 导航
- 外部集成

**后期再做很难**，因为需要重构导航结构。

### 深度链接规则

1.  **全栈构造 (Full Stack Construction)**
    - 链接到 `myapp://product/123`
    - 栈应该是: Home (底) -> Product (顶)
    - 这样点返回能回到 Home，而不是退出 App。

2.  **认证感知**
    - 如果需要登录 -> 保存目标 -> 跳转登录 -> 登录后 -> 跳转目标。

3.  **无效链接**
    - 如果目标不存在 -> 跳转到 Home 或 错误页 (不要 Crash)。

4.  **有状态导航**
    - 如果在活跃会话中链接 -> 不要清空当前栈 -> Push 到顶层 (或询问)。

---

## 7. 导航状态持久化

**应该持久化:**

- 当前 Tab 选择
- 列表滚动位置
- 表单草稿
- 最近的导航栈
- 用户偏好

**不应持久化:**

- 模态状态
- 临时 UI
- 过期数据 (返回时刷新)
- 认证状态 (用安全存储)

---

## 8. 过渡动画 (Transition Animations)

### 平台默认值

- **iOS**: Push 从右滑入，Modal 从底滑入 (或 Sheet)。
- **Android**: Push 淡入+微上滑 (或从右)，Modal 从底滑入。

### 共享元素过渡 (Shared Element)

连接屏幕间的元素：
Screen A (小图) -> 点击 -> Screen B (大图)
图片从 A 位置平滑放大移动到 B 位置。

- React Navigation: Shared Element
- Flutter: Hero widget

---

## 9. 导航反模式

### ❌ 导航七宗罪

| 反模式              | 问题         | 解决方案          |
| :------------------ | :----------- | :---------------- |
| **不一致的返回**    | 用户困惑     | 始终 Pop 栈       |
| **隐藏导航**        | 功能不可发现 | 可见的 Tab/触发器 |
| **过深嵌套**        | 用户迷路     | 最多 3-4 层       |
| **破坏滑动返回**    | iOS 用户暴怒 | 绝不覆盖手势      |
| **无深度链接**      | 无法分享     | 一开始就规划      |
| **Tab 切换重置**    | 工作丢失     | 保持 Tab 状态     |
| **主流程用 Modals** | 无法回溯     | 使用 Stack        |

---

## 10. 导航检查清单

- [ ] **App 类型已确定 (Tab/Drawer/Stack)？**
- [ ] **顶级目的地数量已清点？**
- [ ] **深度链接 URL Scheme 已规划？**
- [ ] **认证流程与导航已集成？**
- [ ] **平板/大屏已考虑？**
- [ ] **所有屏幕都可返回 (无死胡同)？**
- [ ] **离开/返回时状态已保存？**
- [ ] **过渡动画恰当？**
- [ ] **物理返回键 (Android) 处理好了吗？**
- [ ] **预测性返回 (Android 14+) 支持了吗？**

---

> **记住:** 好的导航是隐形的。用户不应该思考**如何**去哪里——他们只是到达那里。如果他们注意到了导航，说明有什么地方错了。
