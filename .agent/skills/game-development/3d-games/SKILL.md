---
name: 3d-games
description: 3D 游戏开发原则。渲染、着色器、物理、相机。
allowed-tools: Read, Write, Edit, Glob, Grep
---

# 3D 游戏开发

> 3D 游戏系统原则。

---

## 1. 渲染管线

### 阶段

```
1. Vertex Processing → 变换几何体
2. Rasterization → 转换为像素
3. Fragment Processing → 为像素着色
4. Output → 输出到屏幕
```

### 优化原则

| 技术 | 目的 |
| --- | --- |
| **Frustum culling（视锥体剔除）** | 不渲染屏幕外物体 |
| **Occlusion culling（遮挡剔除）** | 不渲染被遮挡物体 |
| **LOD（细节层级）** | 远距离更少细节 |
| **Batching（合批）** | 合并 draw calls（绘制调用） |

---

## 2. 着色器原则

### 着色器类型

| 类型 | 目的 |
| --- | --- |
| **Vertex（顶点）** | 位置、法线 |
| **Fragment/Pixel（片元/像素）** | 颜色、光照 |
| **Compute（计算）** | 通用计算 |

### 何时编写自定义着色器

- 特效（水、火、传送门）
- 风格化渲染（卡通、素描）
- 性能优化
- 独特的视觉标识

---

## 3. 3D 物理

### 碰撞形状

| 形状 | 适用场景 |
| --- | --- |
| **Box（盒）** | 建筑物、箱子 |
| **Sphere（球）** | 球体、快速检测 |
| **Capsule（胶囊）** | 角色 |
| **Mesh（网格）** | 地形（开销大） |

### 原则

- 简单碰撞体，复杂视觉
- 基于层的过滤
- 视线检测使用 Raycasting（射线检测）

---

## 4. 相机系统

### 相机类型

| 类型 | 用途 |
| --- | --- |
| **Third-person（第三人称）** | 动作、冒险 |
| **First-person（第一人称）** | 沉浸式、FPS（第一人称射击） |
| **Isometric（等轴测）** | 策略、RPG（角色扮演） |
| **Orbital（轨道）** | 检视、编辑器 |

### 相机手感

- 平滑跟随（lerp，线性插值）
- 避障
- 移动前瞻
- 随速度改变 FOV（视野）

---

## 5. 光照

### 光照类型

| 类型 | 用途 |
| --- | --- |
| **Directional（定向光）** | 太阳、月亮 |
| **Point（点光源）** | 灯、火把 |
| **Spot（聚光灯）** | 手电筒、舞台 |
| **Ambient（环境光）** | 基础照明 |

### 性能考量

- 实时阴影很昂贵
- 尽可能烘焙（Bake）
- 大世界使用 Shadow cascades（级联阴影）

---

## 6. 细节层级（LOD）

### LOD 策略

| 距离 | 模型 |
| --- | --- |
| 近 | 全细节 |
| 中 | 50% 三角形 |
| 远 | 25% 或 billboard（公告板） |

---

## 7. 反模式

| ❌ 禁止 | ✅ 推荐 |
| --- | --- |
| 到处使用 Mesh（网格）碰撞体 | 使用简单形状 |
| 移动端使用实时阴影 | 烘焙或 Blob 阴影（投影） |
| 所有距离使用一个 LOD | 基于距离的 LOD |
| 未优化的着色器 | 先分析再简化 |

---

> **记住：** 3D 关乎错觉。创造细节的印象，而不是细节本身。
