# 查询优化 (Query Optimization)

> N+1 问题, EXPLAIN ANALYZE, 优化优先级。

## N+1 问题

```
什么是 N+1?
├── 1 次查询获取父记录
├── N 次查询获取相关记录
└── 非常慢！

解决方案:
├── JOIN → 单次查询获取所有数据
├── Eager loading (预加载) → ORM 处理 JOIN
├── DataLoader → 批处理和缓存 (GraphQL)
└── Subquery (子查询) → 一次查询获取相关数据
```

## 查询分析思维

```
优化之前:
├── EXPLAIN ANALYZE 查询语句
├── 寻找 Seq Scan (全表扫描)
├── 检查实际行数 vs 预估行数
└── 识别缺失的索引
```

## 优化优先级

1.  **添加缺失的索引** (最常见的问题)
2.  **只选择需要的列** (不要 SELECT \*)
3.  **使用正确的 JOIN** (尽可能避免子查询)
4.  **尽早限制** (在数据库层面进行分页)
5.  **缓存** (如果合适)
