---
name: webapp-testing
description: Web åº”ç”¨æµ‹è¯•åŸåˆ™ã€E2E æµ‹è¯•ç­–ç•¥
allowed-tools: Read, Write, Edit, Glob, Grep, Bash
---

# Web åº”ç”¨æµ‹è¯• (Web App Testing)

> å‘ç°å¹¶æµ‹è¯•ä¸€åˆ‡ã€‚ä¸ç•™ä»»ä½•æœªç»æµ‹è¯•çš„è·¯ç”±ã€‚

## ğŸ”§ è¿è¡Œè„šæœ¬ (Runtime Scripts)

**æ‰§è¡Œä»¥ä¸‹è„šæœ¬è¿›è¡Œè‡ªåŠ¨åŒ–æµè§ˆå™¨æµ‹è¯•ï¼š**

| è„šæœ¬                           | ç”¨é€”           | ç”¨æ³• (Usage)                                              |
| ------------------------------ | -------------- | --------------------------------------------------------- |
| `scripts/playwright_runner.py` | åŸºç¡€æµè§ˆå™¨æµ‹è¯• | `python scripts/playwright_runner.py https://example.com` |
|                                | å¸¦æˆªå›¾æµ‹è¯•     | `python scripts/playwright_runner.py <url> --screenshot`  |
|                                | æ— éšœç¢æ£€æŸ¥     | `python scripts/playwright_runner.py <url> --a11y`        |

**ä¾èµ–é¡¹ï¼š** `pip install playwright && playwright install chromium`

---

## 1. æ·±åº¦å®¡è®¡æ–¹æ³• (Deep Audit Approach)

### æ¢ç´¢ä¼˜å…ˆ (Discovery First)

| ç›®æ ‡          | å‘ç°æ–¹æ³•                             |
| ------------- | ------------------------------------ |
| è·¯ç”± (Routes) | æ‰«æ `app/`, `pages/` ç›®å½•åŠè·¯ç”±æ–‡ä»¶ |
| API ç«¯ç‚¹      | ä½¿ç”¨ Grep æœç´¢ HTTP æ–¹æ³•             |
| ç»„ä»¶          | å¯»æ‰¾ç»„ä»¶ç›®å½•                         |
| åŠŸèƒ½ç‰¹æ€§      | é˜…è¯»ç›¸å…³æ–‡æ¡£                         |

### ç³»ç»ŸåŒ–æµ‹è¯•

1. **æ˜ å°„ (Map)** â€”â€” åˆ—å‡ºæ‰€æœ‰è·¯ç”±/API
2. **æ‰«æ (Scan)** â€”â€” éªŒè¯å®ƒä»¬æ˜¯å¦æœ‰å“åº”
3. **æµ‹è¯• (Test)** â€”â€” è¦†ç›–å…³é”®è·¯å¾„

---

## 2. Web æµ‹è¯•é‡‘å­—å¡” (Testing Pyramid for Web)

```
        /\          E2E æµ‹è¯• (æå°‘)
       /  \         å…³é”®ç”¨æˆ·æµç¨‹
      /----\
     /      \       é›†æˆæµ‹è¯• (Integration) (å°‘é‡)
    /--------\      APIã€æ•°æ®æµ
   /          \
  /------------\    ç»„ä»¶æµ‹è¯• (Component) (å¤§é‡)
                    ç‹¬ç«‹çš„ UI å•å…ƒ
```

---

## 3. E2E æµ‹è¯•åŸåˆ™

### åº”è¯¥æµ‹è¯•ä»€ä¹ˆ

| ä¼˜å…ˆçº§ | æµ‹è¯•ç±»å‹                       |
| ------ | ------------------------------ |
| 1      | æ­£å¸¸è·¯å¾„ (Happy path) ç”¨æˆ·æµç¨‹ |
| 2      | è®¤è¯ (Authentication) æµç¨‹     |
| 3      | å…³é”®ä¸šåŠ¡æ“ä½œ                   |
| 4      | é”™è¯¯å¤„ç†                       |

### E2E æœ€ä½³å®è·µ

| å®è·µé¡¹ç›®           | åŸå›                    |
| ------------------ | ---------------------- |
| ä½¿ç”¨ `data-testid` | ç¨³å®šçš„é€‰æ‹©å™¨           |
| ç­‰å¾…å…ƒç´ å‡ºç°       | é¿å…æµ‹è¯•ä¸ç¨³å®š (flaky) |
| æ¸…å‡€çŠ¶æ€           | æµ‹è¯•ä¹‹é—´ç›¸äº’ç‹¬ç«‹       |
| é¿å…æµ‹è¯•å®ç°ç»†èŠ‚   | æµ‹è¯•ç”¨æˆ·è¡Œä¸ºè¡¨ç°       |

---

## 4. Playwright åŸåˆ™

### æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ                             | ç”¨é€”               |
| -------------------------------- | ------------------ |
| é¡µé¢å¯¹è±¡æ¨¡å‹ (Page Object Model) | å°è£…é¡µé¢é€»è¾‘       |
| å›ºä»¶ (Fixtures)                  | å¯å¤ç”¨çš„æµ‹è¯•è®¾ç½®   |
| æ–­è¨€ (Assertions)                | å†…ç½®çš„è‡ªåŠ¨ç­‰å¾…æœºåˆ¶ |
| è¿½è¸ªæŸ¥çœ‹å™¨ (Trace Viewer)        | è°ƒè¯•å¤±è´¥çš„ç”¨ä¾‹     |

### é…ç½®å»ºè®®

| è®¾ç½®é¡¹         | æ¨èé…ç½®                                 |
| -------------- | ---------------------------------------- |
| é‡è¯• (Retries) | CI ç¯å¢ƒä¸‹è®¾ç½®ä¸º 2 æ¬¡                     |
| è¿½è¸ª (Trace)   | `on-first-retry` (ä»…åœ¨é¦–æ¬¡é‡è¯•æ—¶å¼€å¯)    |
| æˆªå›¾           | `on-failure` (ä»…åœ¨å¤±è´¥æ—¶æˆªå›¾)            |
| è§†é¢‘           | `retain-on-failure` (ä»…åœ¨å¤±è´¥æ—¶ä¿ç•™è§†é¢‘) |

---

## 5. è§†è§‰æµ‹è¯• (Visual Testing)

### ä½•æ—¶ä½¿ç”¨

| åœºæ™¯                       | ä»·å€¼ |
| -------------------------- | ---- |
| è®¾è®¡ç³»ç»Ÿ (Design system)   | é«˜   |
| è¥é”€é¡µé¢ (Marketing pages) | é«˜   |
| ç»„ä»¶åº“                     | ä¸­   |
| åŠ¨æ€å†…å®¹                   | è¾ƒä½ |

### ç­–ç•¥

- å»ºç«‹åŸºå‡†æˆªå›¾ (Baseline)
- åœ¨å˜æ›´æ—¶è¿›è¡Œå¯¹æ¯”
- è¯„å®¡è§†è§‰å·®å¼‚ (diffs)
- æ›´æ–°é¢„æœŸçš„è§†è§‰å˜æ›´

---

## 6. API æµ‹è¯•åŸåˆ™

### è¦†ç›–é¢†åŸŸ

| é¢†åŸŸ     | æµ‹è¯•å†…å®¹                   |
| -------- | -------------------------- |
| çŠ¶æ€ç    | 200, 400, 404, 500         |
| å“åº”ç»“æ„ | æ˜¯å¦ç¬¦åˆ Schema (æ¨¡å¼)     |
| é”™è¯¯æ¶ˆæ¯ | æ˜¯å¦å¯¹ç”¨æˆ·å‹å¥½             |
| è¾¹ç¼˜æƒ…å†µ | ç©ºæ•°æ®ã€å¤§æ•°æ®é‡ã€ç‰¹æ®Šå­—ç¬¦ |

---

## 7. æµ‹è¯•ç»„ç»‡

### æ–‡ä»¶ç»“æ„

```
tests/
â”œâ”€â”€ e2e/           # å®Œæ•´ç”¨æˆ·æµç¨‹
â”œâ”€â”€ integration/   # API ä¸æ•°æ®é›†æˆ
â”œâ”€â”€ component/     # UI å•å…ƒæµ‹è¯•
â””â”€â”€ fixtures/      # å…±äº«æ•°æ®å›ºä»¶
```

### å‘½åä¹ æƒ¯

| æ¨¡å¼       | ç¤ºä¾‹                        |
| ---------- | --------------------------- |
| åŸºäºåŠŸèƒ½   | `login.spec.ts`             |
| æè¿°æ€§å‘½å | `user-can-checkout.spec.ts` |

---

## 8. CI é›†æˆ

### æµæ°´çº¿æ­¥éª¤ (Pipeline Steps)

1. å®‰è£…ä¾èµ–é¡¹
2. å®‰è£…æµè§ˆå™¨
3. è¿è¡Œæµ‹è¯•
4. ä¸Šä¼ äº§ç‰©ï¼ˆè¿½è¸ªè®°å½•ã€æˆªå›¾ç­‰ï¼‰

### å¹¶è¡ŒåŒ–ç­–ç•¥

| ç­–ç•¥            | ç”¨æ³•                |
| --------------- | ------------------- |
| æŒ‰æ–‡ä»¶å¹¶è¡Œ      | Playwright é»˜è®¤è¡Œä¸º |
| åˆ†ç‰‡ (Sharding) | ç”¨äºåºå¤§çš„æµ‹è¯•å¥—ä»¶  |
| Worker è¿›ç¨‹     | å¤šä¸ªæµè§ˆå™¨åŒæ—¶å¼€å¯  |

---

## 9. åæ¨¡å¼ (Anti-Patterns)

| âŒ ä¸è¦ (Don't)  | âœ… è¦ (Do)       |
| ---------------- | ---------------- |
| æµ‹è¯•å®ç°ç»†èŠ‚     | æµ‹è¯•è¡Œä¸ºè¡¨ç°     |
| ç¡¬ç¼–ç ç­‰å¾…æ—¶é—´   | ä½¿ç”¨è‡ªåŠ¨ç­‰å¾…åŠŸèƒ½ |
| è·³è¿‡æ¸…ç†æ­¥éª¤     | ä¿æŒæµ‹è¯•éš”ç¦»     |
| å¿½è§†ä¸ç¨³å®šçš„æµ‹è¯• | ä¿®å¤æ ¹æœ¬åŸå›      |

---

> **è®°ä½ï¼š** E2E æµ‹è¯•æˆæœ¬å¾ˆé«˜ã€‚è¯·ä»…å°†å…¶ç”¨äºå…³é”®ä¸šåŠ¡è·¯å¾„ã€‚
