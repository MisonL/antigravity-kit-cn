---
name: webapp-testing
description: Web åº”ç”¨æµ‹è¯•åŸåˆ™ã€E2E æµ‹è¯•ç­–ç•¥
allowed-tools: Read, Write, Edit, Glob, Grep, Bash
---

# Web App Testing - Web åº”ç”¨æµ‹è¯•

> å‘ç°å¹¶æµ‹è¯•ä¸€åˆ‡ã€‚ä¸é—æ¼ä»»ä½•è·¯ç”±ã€‚

## ğŸ”§ è¿è¡Œæ—¶è„šæœ¬ (Runtime Scripts)

**æ‰§è¡Œè¿™äº›è¿›è¡Œè‡ªåŠ¨åŒ–æµè§ˆå™¨æµ‹è¯•ï¼š**

| è„šæœ¬                           | ç”¨é€”           | ç”¨æ³•                                                      |
| ------------------------------ | -------------- | --------------------------------------------------------- |
| `scripts/playwright_runner.py` | åŸºç¡€æµè§ˆå™¨æµ‹è¯• | `python scripts/playwright_runner.py https://example.com` |
|                                | å¸¦æˆªå›¾         | `python scripts/playwright_runner.py <url> --screenshot`  |
|                                | æ— éšœç¢æ£€æŸ¥     | `python scripts/playwright_runner.py <url> --a11y`        |

**éœ€è¦ï¼š** `pip install playwright && playwright install chromium`

---

## 1. æ·±åº¦å®¡è®¡æ–¹æ³• (Deep Audit Approach)

### å‘ç°ä¼˜å…ˆ

| ç›®æ ‡     | å¦‚ä½•æŸ¥æ‰¾                       |
| -------- | ------------------------------ |
| è·¯ç”±     | æ‰«æ app/, pages/, router æ–‡ä»¶ |
| API ç«¯ç‚¹ | Grep æœç´¢ HTTP æ–¹æ³•            |
| ç»„ä»¶     | æŸ¥æ‰¾ç»„ä»¶ç›®å½•                   |
| åŠŸèƒ½     | é˜…è¯»æ–‡æ¡£                       |

### ç³»ç»ŸåŒ–æµ‹è¯•

1. **Map (æ˜ å°„)** - åˆ—å‡ºæ‰€æœ‰è·¯ç”±/API
2. **Scan (æ‰«æ)** - éªŒè¯å®ƒä»¬æ˜¯å¦å“åº”
3. **Test (æµ‹è¯•)** - è¦†ç›–å…³é”®è·¯å¾„

---

## 2. Web æµ‹è¯•é‡‘å­—å¡” (Testing Pyramid for Web)

```
        /\          E2E (Few - å°‘)
       /  \         å…³é”®ç”¨æˆ·æµç¨‹ (Critical user flows)
      /----\
     /      \       Integration (Some - ä¸€äº›)
    /--------\      API, æ•°æ®æµ (API, data flow)
   /          \
  /------------\    Component (Many - å¤š)
                    ç‹¬ç«‹ UI ç‰‡æ®µ (Individual UI pieces)
```

---

## 3. E2E æµ‹è¯•åŸåˆ™ (E2E Test Principles)

### æµ‹è¯•ä»€ä¹ˆ

| ä¼˜å…ˆçº§ | æµ‹è¯•                |
| ------ | ------------------- |
| 1      | Happy path ç”¨æˆ·æµç¨‹ |
| 2      | è®¤è¯æµç¨‹            |
| 3      | å…³é”®ä¸šåŠ¡æ“ä½œ        |
| 4      | é”™è¯¯å¤„ç†            |

### E2E æœ€ä½³å®è·µ

| å®è·µ             | ä¸ºä»€ä¹ˆ           |
| ---------------- | ---------------- |
| ä½¿ç”¨ data-testid | ç¨³å®šçš„é€‰æ‹©å™¨     |
| ç­‰å¾…å…ƒç´          | é¿å…ä¸ç¨³å®šçš„æµ‹è¯• |
| å¹²å‡€çŠ¶æ€         | ç‹¬ç«‹æµ‹è¯•         |
| é¿å…å®ç°ç»†èŠ‚     | æµ‹è¯•ç”¨æˆ·è¡Œä¸º     |

---

## 4. Playwright åŸåˆ™

### æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ              | ç”¨é€”             |
| ----------------- | ---------------- |
| Page Object Model | å°è£…é¡µé¢é€»è¾‘     |
| Fixtures          | å¯å¤ç”¨çš„æµ‹è¯•è®¾ç½® |
| Assertions        | å†…ç½®è‡ªåŠ¨ç­‰å¾…     |
| Trace Viewer      | è°ƒè¯•å¤±è´¥         |

### é…ç½®

| è®¾ç½®        | æ¨è              |
| ----------- | ----------------- |
| Retries     | CI ä¸Š 2 æ¬¡        |
| Trace       | on-first-retry    |
| Screenshots | on-failure        |
| Video       | retain-on-failure |

---

## 5. è§†è§‰æµ‹è¯• (Visual Testing)

### ä½•æ—¶ä½¿ç”¨

| åœºæ™¯     | ä»·å€¼ |
| -------- | ---- |
| è®¾è®¡ç³»ç»Ÿ | é«˜   |
| è¥é”€é¡µé¢ | é«˜   |
| ç»„ä»¶åº“   | ä¸­   |
| åŠ¨æ€å†…å®¹ | è¾ƒä½ |

### ç­–ç•¥

- åŸºçº¿æˆªå›¾
- å˜æ›´æ—¶æ¯”è¾ƒ
- å®¡æŸ¥è§†è§‰å·®å¼‚
- æ›´æ–°æœ‰æ„ä¸ºä¹‹çš„å˜æ›´

---

## 6. API æµ‹è¯•åŸåˆ™ (API Testing Principles)

### è¦†ç›–é¢†åŸŸ

| é¢†åŸŸ     | æµ‹è¯•               |
| -------- | ------------------ |
| çŠ¶æ€ç    | 200, 400, 404, 500 |
| å“åº”å½¢çŠ¶ | åŒ¹é… Schema        |
| é”™è¯¯æ¶ˆæ¯ | ç”¨æˆ·å‹å¥½           |
| è¾¹ç¼˜æƒ…å†µ | ç©º, å¤§, ç‰¹æ®Šå­—ç¬¦   |

---

## 7. æµ‹è¯•ç»„ç»‡ (Test Organization)

### æ–‡ä»¶ç»“æ„

```
tests/
â”œâ”€â”€ e2e/           # å®Œæ•´ç”¨æˆ·æµç¨‹
â”œâ”€â”€ integration/   # API, æ•°æ®
â”œâ”€â”€ component/     # UI å•å…ƒ
â””â”€â”€ fixtures/      # å…±äº«æ•°æ®
```

### å‘½åçº¦å®š

| æ¨¡å¼     | ç¤ºä¾‹                        |
| -------- | --------------------------- |
| åŸºäºç‰¹æ€§ | `login.spec.ts`             |
| æè¿°æ€§   | `user-can-checkout.spec.ts` |

---

## 8. CI é›†æˆ (CI Integration)

### æµæ°´çº¿æ­¥éª¤

1. å®‰è£…ä¾èµ–
2. å®‰è£…æµè§ˆå™¨
3. è¿è¡Œæµ‹è¯•
4. ä¸Šä¼  Artifacts (traces, screenshots)

### å¹¶è¡ŒåŒ–

| ç­–ç•¥            | ç”¨é€”            |
| --------------- | --------------- |
| æŒ‰æ–‡ä»¶          | Playwright é»˜è®¤ |
| åˆ†ç‰‡ (Sharding) | å¤§å‹å¥—ä»¶        |
| Workers         | å¤šä¸ªæµè§ˆå™¨      |

---

## 9. åæ¨¡å¼ (Anti-Patterns)

| âŒ ä¸è¦ (Don't)  | âœ… è¦ (Do)   |
| ---------------- | ------------ |
| æµ‹è¯•å®ç°         | æµ‹è¯•è¡Œä¸º     |
| ç¡¬ç¼–ç ç­‰å¾…       | ä½¿ç”¨è‡ªåŠ¨ç­‰å¾… |
| è·³è¿‡æ¸…ç†         | éš”ç¦»æµ‹è¯•     |
| å¿½ç•¥ä¸ç¨³å®šçš„æµ‹è¯• | ä¿®å¤æ ¹æœ¬åŸå›  |

---

> **è®°ä½ï¼š** E2E æµ‹è¯•å¾ˆæ˜‚è´µã€‚ä»…å°†å…¶ç”¨äºå…³é”®è·¯å¾„ã€‚
