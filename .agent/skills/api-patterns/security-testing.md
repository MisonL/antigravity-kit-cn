# API 安全测试

> API 安全测试原则。OWASP API Top 10、认证与授权测试。

---

## OWASP API Top 10（安全前十）

| 漏洞 | 测试重点 |
|---------------|------------|
| **API1: BOLA** | 访问其他用户资源 |
| **API2: Broken Auth** | JWT、会话、凭证 |
| **API3: Property Auth** | 批量赋值、数据暴露 |
| **API4: Resource Consumption** | 速率限制、DoS |
| **API5: Function Auth** | 管理端点、角色绕过 |
| **API6: Business Flow** | 逻辑滥用、自动化 |
| **API7: SSRF** | 内网访问 |
| **API8: Misconfiguration** | 调试端点、CORS |
| **API9: Inventory** | 影子 API、旧版本 |
| **API10: Unsafe Consumption** | 第三方 API 信任 |

---

## 认证测试

### JWT 测试

| 检查项 | 测试内容 |
|-------|--------------|
| 算法 | None、算法混淆 |
| 密钥 | 弱密钥、暴力破解 |
| 声明 | 过期、签发者、受众 |
| 签名 | 篡改、密钥注入 |

### 会话测试

| 检查项 | 测试内容 |
|-------|--------------|
| 生成 | 可预测性 |
| 存储 | 客户端侧安全 |
| 过期 | 超时强制 |
| 失效 | 注销有效性 |

---

## 授权测试

| 测试类型 | 方法 |
|-----------|----------|
| **水平** | 访问同级用户数据 |
| **垂直** | 访问更高权限功能 |
| **上下文** | 访问超出允许范围 |

### BOLA/IDOR 测试

1. 识别请求中的资源 ID
2. 以用户 A 会话捕获请求
3. 以用户 B 会话重放请求
4. 检查是否存在未授权访问

---

## 输入验证测试

| 注入类型 | 测试重点 |
|----------------|------------|
| SQL | 查询篡改 |
| NoSQL | 文档查询 |
| 命令 | 系统命令 |
| LDAP | 目录查询 |

**方法：** 测试所有参数，尝试类型强制，测试边界，检查错误信息。

---

## 速率限制测试

| 方面 | 检查 |
|--------|-------|
| 存在性 | 是否有限制 |
| 绕过 | 请求头（Header）、IP 轮换 |
| 范围 | 每用户、每 IP、全局 |

**绕过手法：** X-Forwarded-For、不同 HTTP 方法、大小写变体、API 版本。

---

## GraphQL 安全

| 测试 | 重点 |
|------|-------|
| 内省 | Schema（模式）泄露 |
| 批量 | 查询型 DoS |
| 嵌套 | 深度型 DoS |
| 授权 | 字段级访问 |

---

## 安全测试检查清单

**认证：**
- [ ] 测试绕过
- [ ] 检查凭证强度
- [ ] 验证令牌安全

**授权：**
- [ ] 测试 BOLA/IDOR
- [ ] 检查权限提升
- [ ] 验证功能访问

**输入：**
- [ ] 测试所有参数
- [ ] 检查注入

**配置：**
- [ ] 检查 CORS
- [ ] 验证请求头（Header）
- [ ] 测试错误处理

---

> **记住：** API 是现代应用的骨干，像攻击者一样测试它们。
