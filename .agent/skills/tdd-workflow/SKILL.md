---
name: tdd-workflow
description: 测试驱动开发 (TDD) 工作流原则。红-绿-重构循环。
allowed-tools: Read, Write, Edit, Glob, Grep, Bash
---

# TDD Workflow - TDD 工作流

> 先写测试，后写代码。

---

## 1. TDD 循环

```
🔴 RED (红) → 编写失败的测试
    ↓
🟢 GREEN (绿) → 编写最小代码以通过
    ↓
🔵 REFACTOR (重构) → 改进代码质量
    ↓
   重复...
```

---

## 2. TDD 三定律

1. 除非为了让一个失败的测试通过，否则不编写生产代码
2. 只编写足以展示失败的测试
3. 只编写足以让测试通过的代码

---

## 3. RED 阶段原则

### 写什么

| 关注点                  | 示例                            |
| ----------------------- | ------------------------------- |
| 行为 (Behavior)         | "should add two numbers"        |
| 边缘情况 (Edge cases)   | "should handle empty input"     |
| 错误状态 (Error states) | "should throw for invalid data" |

### RED 阶段规则

- 测试必须首先失败
- 测试名称描述预期行为
- 每个测试一个断言 (理想情况下)

---

## 4. GREEN 阶段原则

### 最小代码

| 原则           | 含义                                  |
| -------------- | ------------------------------------- |
| **YAGNI**      | 你不需要它 (You Aren't Gonna Need It) |
| **最简单的事** | 编写通过测试的最小量代码              |
| **无优化**     | 只是让它可以工作                      |

### GREEN 阶段规则

- 不要编写不需要的代码
- 尚不要优化
- 通过测试，别无其他

---

## 5. REFACTOR 阶段原则

### 改进什么

| 领域   | 行动         |
| ------ | ------------ |
| 重复   | 提取公共代码 |
| 命名   | 让意图清晰   |
| 结构   | 改进组织     |
| 复杂性 | 简化逻辑     |

### REFACTOR 规则

- 所有测试必须保持绿色
- 小步增量更改
- 每次重构后提交

---

## 6. AAA 模式

每个测试遵循：

| 步骤        | 目的         |
| ----------- | ------------ |
| **Arrange** | 设置测试数据 |
| **Act**     | 执行被测代码 |
| **Assert**  | 验证预期结果 |

---

## 7. 何时使用 TDD

| 场景                 | TDD 价值             |
| -------------------- | -------------------- |
| 新功能               | 高                   |
| Bug 修复             | 高 (先写测试)        |
| 复杂逻辑             | 高                   |
| 探索性 (Exploratory) | 低 (Spike, 然后 TDD) |
| UI 布局              | 低                   |

---

## 8. 测试优先级

| 优先级 | 测试类型               |
| ------ | ---------------------- |
| 1      | Happy path (快乐路径)  |
| 2      | Error cases (错误情况) |
| 3      | Edge cases (边缘情况)  |
| 4      | Performance (性能)     |

---

## 9. 反模式

| ❌ 不要 (Don't) | ✅ 要 (Do)       |
| --------------- | ---------------- |
| 跳过 RED 阶段   | 看着测试首先失败 |
| 后写测试        | 先写测试         |
| 初始过度设计    | 保持简单         |
| 多个断言        | 每个测试一种行为 |
| 测试实现细节    | 测试行为         |

---

## 10. AI 增强 TDD

### 多智能体模式

| Agent   | 角色                 |
| ------- | -------------------- |
| Agent A | 编写失败的测试 (RED) |
| Agent B | 实现以通过 (GREEN)   |
| Agent C | 优化 (REFACTOR)      |

---

> **记住：** 测试就是规范。如果你不能写出测试，你就不理解需求。
